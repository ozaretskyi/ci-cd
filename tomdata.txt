#!/bin/bash -v
echo "Start packages installation" >> ~/bootstrapped
yum update -y
yum install epel-release -y
yum makecache fast
yum update -y
yum install python-boto -y
yum install python-pip -y
pip install awscli --upgrade
pip install ansible
yum clean all
echo "Install Java" >> ~/bootstrapped
yum install java-1.8.0-openjdk -y
echo "Install Tomcat" >> ~/bootstrapped
wget http://apache.ip-connect.vn.ua/tomcat/tomcat-9/v9.0.0.M18/bin/apache-tomcat-9.0.0.M18.tar.gz
tar -zxpvf apache-tomcat-9.0.0.M18.tar.gz -C /opt/
cd /opt
mv apache-tomcat-9.0.0.M18 tomcat
echo "export CATALINA_HOME='/opt/tomcat/'" >> ~/.bashrc
source ~/.bashrc
cd /opt/tomcat
chgrp -R tomcat conf
chmod g+rwx conf
chmod g+r conf/*
chown -R tomcat:tomcat work/ temp/ logs/
cd /opt/tomcat/bin
chmod +x *.sh

echo "Config Tomcat users" >> ~/bootstrapped
echo "<?xml version="1.0" encoding="UTF-8"?>" > /opt/tomcat/conf/tomcat-users.xml
echo "<tomcat-users>" >> /opt/tomcat/conf/tomcat-users.xml
echo "<user username="admin" password="password" roles="manager-gui,admin-gui"/>" >> /opt/tomcat/conf/tomcat-users.xml
echo "</tomcat-users>" >> /opt/tomcat/conf/tomcat-users.xml

./startup.sh
echo "bootstrapped with userdata" >> ~/bootstrapped
